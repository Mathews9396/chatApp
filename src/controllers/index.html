<!DOCTYPE html>
<html lang="en">

<head>
  <title>Socket.IO chat</title>
  <style>
    body {
      margin: 0;
      padding-bottom: 3rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    #form {
      background: rgba(0, 0, 0, 0.15);
      padding: 0.25rem;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      height: 3rem;
      box-sizing: border-box;
      backdrop-filter: blur(10px);
    }

    #input {
      border: none;
      padding: 0 1rem;
      flex-grow: 1;
      border-radius: 2rem;
      margin: 0.25rem;
    }

    #input:focus {
      outline: none;
    }

    #form>button {
      background: #333;
      border: none;
      padding: 0 1rem;
      margin: 0.25rem;
      border-radius: 3px;
      outline: none;
      color: #fff;
    }

    #messages {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    #messages>li {
      padding: 0.5rem 1rem;
    }

    #messages>li:nth-child(odd) {
      background: #efefef;
    }
  </style>
</head>

<body>
  <ul id="messages"></ul>
  <form id="form" action="">
    <input id="input" autocomplete="off" /><button>Send</button>
  </form>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();  // add the url to listen to otherwise it will listen to localhost

    var messages = document.getElementById('messages');
    var form = document.getElementById('form');
    var input = document.getElementById('input');

    const params = new URLSearchParams(window.location.search)
    console.log("room: ", params.get("room"));

    // const roomId = parseInt(params.get("room"))
    const roomId = params.get("room")
    const userId = params.get("user")

    socket.emit('join',
      { roomId: roomId, userId: userId },
      (response) => {
        response.emitData
      });

    var newMsg = function (msg) {
      var item = document.createElement('li');
      item.textContent = msg;
      messages.appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();
      if (input.value) {
        socket.emit('chat message', input.value);
        newMsg(input.value)
        input.value = '';  // since the same room is not listening now

        // socket.emit("addComment", {
        //   parentCommentUuid: 'b1a19935-676e-4b65-ae27-6d69137fbf90',
        //   uuid: "b1a19935-676e-4b65-ae27-6d69137fbf94",
        //   content: "@[mathews.test](1090) hi there",
        //   resolved: false,
        //   position: {},
        //   colorCode: "#00022",
        //   // taggedUserIds: [],
        //   pageId: 16,
        //   // taggedUserIds: [{ "name": "Matt_Dev", "id": 16, "range": [0, 11], "fullText": "@matt_dev test comment-2", "index": 0 }],
        //   isDeleted: false
        // })

        // socket.emit("ufd_status", {
        //   status: "inProgress"
        // })
        // socket.emit("removeUserFlowDiagram", {})

        // socket.emit("readAllComments", {})


        // socket.emit("shapeModified",
        // })

        // socket.emit("fetchPageData", { pageId: 1 }, (response) => {
        //   response.emitData
        // })
        // socket.emit("readAllComments", { pageId: 14 }, (response) => {
        //   response.emitData
        // })

        // socket.emit("pageCreated", {}, (response)=> {
        //   response.emitData
        // })

        // socket.emit("duplicatePage",
        //   {
        //     wbPageId: 'x8IdDp6zwG'
        //   }, (response) => {
        //     response.emitData
        //   })

        // socket.emit("pageNameChanged", {
        //   wbPageId: 'tirP5Te50u',
        //   pageName: 'Page 11'
        // })

        // socket.emit("pageDeleted", { wbPageId: 'aKOSt60MNj', isDeleted: true })
        // socket.emit("duplicatePage", { wbPageId: 'GdqqBsJkUh' })

        // socket.emit("sendBackFront", {
        //   stackOrder: [
        //   'b1a19935-676e-4b65-ae27-6d69137fbb72',
        //   'b1a19935-676e-4b65-ae27-6d69137fbb71',
        //   'b1a19935-676e-4b65-ae27-6d69137fbb73'
        //   ],
        //   pageId: 41
        // })

        // socket.emit("shapeCreated",
        //   [
        //     {
        //       whiteboardId: 42,
        //       userId: 54,
        //       pageId: 41,
        //       uuid: 'b1a19935-676e-4b65-ae27-6d69137fbb73',
        //       createdBy: 54,
        //       actionTaken: 'shape created',
        //       itemType: 'rect',
        //       itemText: 'testing raw query-2',
        //       properties: {
        //         "type": "group",
        //         "version": "5.3.0",
        //         "originX": "center",
        //         "originY": "center",
        //         "left": -1400.14,
        //         "top": 5557.92,
        //         "width": 221,
        //         "height": 221,
        //         "fill": "rgb(0,0,0)",
        //         "stroke": null,
        //         "strokeWidth": 0,
        //         "strokeDashArray": null,
        //         "strokeLineCap": "butt",
        //         "strokeDashOffset": 0,
        //         "strokeLineJoin": "miter",
        //         "strokeUniform": false,
        //         "strokeMiterLimit": 4,
        //         "scaleX": 6.72,
        //         "scaleY": 6.72,
        //         "angle": 0,
        //         "flipX": false,
        //         "flipY": false,
        //         "opacity": 1,
        //         "shadow": null,
        //         "visible": true,
        //         "backgroundColor": "",
        //         "fillRule": "nonzero",
        //         "paintFirst": "fill",
        //         "globalCompositeOperation": "source-over",
        //         "skewX": 0,
        //         "skewY": 0,
        //         "uuid": "3cc8bc68-c931-4a1b-a878-304df5c1c669",
        //         "whiteBoardId": 604,
        //         "createdBy": 16,
        //         "modifiedBy": 16,
        //         "shapeType": "sticky",
        //         "lines": [],
        //         "leftPolygon": null,
        //         "rightPolygon": null,
        //         "size": null,
        //         "lockMovementX": false,
        //         "lockMovementY": false,
        //         "hasBorders": true,
        //         "hoverCursor": null,
        //         "lockScalingFlip": true,
        //         "hasControls": true,
        //         "attachedFrameId": null,
        //         "calculatedPos": null
        //       },
        //       modifiedBy: 54,
        //       isDeleted: false
        //     }
        //   ]
        // )


      }
    });

    socket.on('chat message', newMsg);
  </script>
</body>

</html>